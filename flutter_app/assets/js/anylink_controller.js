"use strict";(()=>{var Ct=Object.create;var at=Object.defineProperty;var bt=Object.getOwnPropertyDescriptor;var Ft=Object.getOwnPropertyNames;var wt=Object.getPrototypeOf,St=Object.prototype.hasOwnProperty;var X=(i,t)=>()=>(t||i((t={exports:{}}).exports,t),t.exports);var At=(i,t,s,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let c of Ft(t))!St.call(i,c)&&c!==s&&at(i,c,{get:()=>t[c],enumerable:!(a=bt(t,c))||a.enumerable});return i};var S=(i,t,s)=>(s=i!=null?Ct(wt(i)):{},At(t||!i||!i.__esModule?at(s,"default",{value:i,enumerable:!0}):s,i));var O=X((Bt,it)=>{it.exports=globalThis.React});var _=X((_t,st)=>{st.exports=globalThis.FuickFramework});var lt=X(M=>{"use strict";var vt=O(),xt=Symbol.for("react.element"),Tt=Symbol.for("react.fragment"),Pt=Object.prototype.hasOwnProperty,Et=vt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Rt={key:!0,ref:!0,__self:!0,__source:!0};function ct(i,t,s){var a,c={},w=null,m=null;s!==void 0&&(w=""+s),t.key!==void 0&&(w=""+t.key),t.ref!==void 0&&(m=t.ref);for(a in t)Pt.call(t,a)&&!Rt.hasOwnProperty(a)&&(c[a]=t[a]);if(i&&i.defaultProps)for(a in t=i.defaultProps,t)c[a]===void 0&&(c[a]=t[a]);return{$$typeof:xt,type:i,key:w,ref:m,props:c,_owner:Et.current}}M.Fragment=Tt;M.jsx=ct;M.jsxs=ct});var Y=X((Ot,dt)=>{"use strict";dt.exports=lt()});var P=S(O()),h=S(_());var f=S(O()),e=S(_());var k=S(_()),C=class{static async disconnect(){return await globalThis.dartCallNativeAsync("Control.disconnect",{})===!0}static async isConnected(){return await globalThis.dartCallNative("Control.isConnected",{})===!0}static async sendClick(t,s){return await globalThis.dartCallNativeAsync("Control.sendClick",{x:t,y:s,duration:50})===!0}static async sendSwipe(t,s,a,c,w=300){return await globalThis.dartCallNativeAsync("Control.sendSwipe",{startX:t,startY:s,endX:a,endY:c,duration:w})===!0}static async sendBack(){return await globalThis.dartCallNativeAsync("Control.sendBack",{})===!0}static async sendHome(){return await globalThis.dartCallNativeAsync("Control.sendHome",{})===!0}static async sendRecent(){return await globalThis.dartCallNativeAsync("Control.sendRecent",{})===!0}static async sendLongPress(t,s,a=1e3){return await globalThis.dartCallNativeAsync("Control.sendLongPress",{x:t,y:s,duration:a})===!0}static async sendText(t){return await globalThis.dartCallNativeAsync("Control.sendText",{text:t})===!0}static async isAccessibilityEnabled(){return await globalThis.dartCallNativeAsync("Control.isAccessibilityEnabled",{})===!0}static async openAccessibilitySettings(){return await globalThis.dartCallNativeAsync("Control.openAccessibilitySettings",{})===!0}static async copyToClipboard(t){return await globalThis.dartCallNativeAsync("Control.copyToClipboard",{text:t})===!0}static onConnectionStateChange(t){let s=c=>t("connected",c),a=()=>t("disconnected");return k.NativeEvent.on("connected",s),k.NativeEvent.on("disconnected",a),()=>{k.NativeEvent.off("connected",s),k.NativeEvent.off("disconnected",a)}}static onClientConnected(t){let s=a=>t(a);return k.NativeEvent.on("onClientConnected",s),()=>{k.NativeEvent.off("onClientConnected",s)}}};var K=S(_()),W=class{static async startCapture(t={}){return await globalThis.dartCallNativeAsync("ScreenCapture.startCapture",{quality:90,maxWidth:1920,maxHeight:1080,frameRate:30,...t})===!0}static async stopCapture(){return await globalThis.dartCallNativeAsync("ScreenCapture.stopCapture",{})}static onScreenFrame(t){let s=a=>{if(!a||!a.data)return;let c={data:`data:image/jpeg;base64,${a.data}`,timestamp:a.timestamp,width:a.width,height:a.height,originalWidth:a.originalWidth,originalHeight:a.originalHeight};t(c)};return K.NativeEvent.on("screen_frame",s),()=>{K.NativeEvent.off("screen_frame",s)}}};var L=class{static async startCall(t){return await globalThis.dartCallNativeAsync("WebRTC.startCall",{isCaller:t})}static async stopCall(){return await globalThis.dartCallNativeAsync("WebRTC.stopCall",{})}};var o=S(Y());function Z(i){let{device:t}=i,s=(0,e.useNavigator)(),[a,c]=(0,f.useState)(null),[w,m]=(0,f.useState)(null),[l,N]=(0,f.useState)({width:0,height:0}),[x,G]=(0,f.useState)({width:0,height:0}),[d,V]=(0,f.useState)({width:0,height:0}),[H,q]=(0,f.useState)(!0),[T,B]=(0,f.useState)(0),z=(0,f.useRef)({x:0,y:0}),kt=(0,f.useRef)(null),$=(0,f.useRef)(0),ot=(0,f.useRef)(Date.now());(0,f.useEffect)(()=>{let g=W.onScreenFrame(p=>{if(p.data){let A=p.data.replace(/[\r\n]/g,"");m(A)}$.current++;let y=Date.now();if(y-ot.current>=1e3&&(B($.current),$.current=0,ot.current=y),typeof p.width=="number"&&typeof p.height=="number"){let A=p.width,R=p.height;N(v=>v.width===A&&v.height===R?v:{width:A,height:R})}if(typeof p.originalWidth=="number"&&typeof p.originalHeight=="number"){let A=p.originalWidth,R=p.originalHeight;G(v=>v.width===A&&v.height===R?v:{width:A,height:R})}}),E=C.onConnectionStateChange((p,y)=>{p==="connected"?t?.ip!=="P2P"&&L.startCall(!0):(c("Connection Lost"),L.stopCall())});return()=>{g(),E(),L.stopCall(),C.disconnect()}},[t]);let gt=g=>{if(d.width&&d.height&&l.width&&l.height){let E=d.width/l.width,p=d.height/l.height,y=Math.min(E,p),A=l.width*y,R=l.height*y,v=(d.width-A)/2,j=(d.height-R)/2,Q=g.localPosition.dx,J=g.localPosition.dy,b=(Q-v)/y,F=(J-j)/y;x.width&&x.height?(b=b*(x.width/l.width),F=F*(x.height/l.height)):(b=b*2,F=F*2),z.current={x:b,y:F}}},mt=async g=>{if(d.width&&d.height&&l.width&&l.height){let E=d.width/l.width,p=d.height/l.height,y=Math.min(E,p),A=l.width*y,R=l.height*y,v=(d.width-A)/2,j=(d.height-R)/2,Q=g.localPosition.dx,J=g.localPosition.dy,b=(Q-v)/y,F=(J-j)/y;x.width&&x.height?(b=b*(x.width/l.width),F=F*(x.height/l.height)):(b=b*2,F=F*2);let nt=z.current.x,rt=z.current.y;Math.sqrt(Math.pow(b-nt,2)+Math.pow(F-rt,2))<10?await ut(b,F):await ht(nt,rt,b,F)}},ut=async(g,E)=>{await C.sendClick(g,E)},ht=async(g,E,p,y)=>{await C.sendSwipe(g,E,p,y,300)},pt=()=>C.sendBack(),yt=()=>C.sendHome(),ft=()=>C.sendRecent();return a?(0,o.jsx)(e.Scaffold,{appBar:(0,o.jsx)(e.AppBar,{title:(0,o.jsx)(e.Text,{text:"Connection Error",fontSize:20,fontWeight:"bold",color:"#FFFFFF"}),leading:(0,o.jsx)(e.GestureDetector,{onTap:()=>s.pop(),children:(0,o.jsx)(e.Container,{padding:4,children:(0,o.jsx)(e.Icon,{name:"arrow_back",size:24,color:"#FFFFFF"})})}),backgroundColor:"#F44336"}),children:(0,o.jsx)(e.Container,{color:"#000000",children:(0,o.jsxs)(e.Column,{mainAxisAlignment:"center",crossAxisAlignment:"center",padding:32,children:[(0,o.jsx)(e.Icon,{name:"error",size:64,color:"#F44336"}),(0,o.jsx)(e.Text,{text:a,fontSize:16,color:"#FFFFFF",margin:{top:16}}),(0,o.jsx)(e.Button,{text:"Go Back",onTap:()=>s.pop(),margin:{top:24}}),(0,o.jsx)(e.Button,{text:"Load Test Image",onTap:()=>{m("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z8BQDwAEhQGAhKmMIQAAAABJRU5ErkJggg=="),c(null)},margin:{top:24}})]})})}):(0,o.jsx)(e.Scaffold,{appBar:H?(0,o.jsx)(e.AppBar,{title:(0,o.jsx)(e.Text,{text:t?.name||"AnyLink Remote",fontSize:20,fontWeight:"bold",color:"#FFFFFF"}),leading:(0,o.jsx)(e.GestureDetector,{onTap:()=>s.pop(),children:(0,o.jsx)(e.Container,{padding:4,children:(0,o.jsx)(e.Icon,{name:"arrow_back",size:24,color:"#FFFFFF"})})}),backgroundColor:"#2563EB"}):void 0,children:(0,o.jsxs)(e.Stack,{children:[(0,o.jsx)(e.Positioned,{left:0,right:0,top:0,bottom:0,children:(0,o.jsx)(e.Container,{color:"#000000",children:(0,o.jsx)(e.VisibilityDetector,{onVisibilityChanged:g=>{(g.size.width!==d.width||g.size.height!==d.height)&&V(g.size)},children:(0,o.jsx)(e.PointerListener,{onPointerDown:g=>gt(g),onPointerUp:g=>mt(g),children:(0,o.jsx)(e.Container,{alignment:"center",width:d.width||300,height:d.height||600,color:"#333333",children:w?(0,o.jsx)(e.Stack,{children:(0,o.jsx)(e.Image,{url:w,fit:"contain",width:d.width||300,height:d.height||600})}):(0,o.jsxs)(e.Column,{mainAxisAlignment:"center",children:[(0,o.jsx)(e.CircularProgressIndicator,{color:"#2563EB"}),(0,o.jsx)(e.Text,{text:"Waiting for stream...",fontSize:14,color:"#888888",margin:{top:16}})]})})})})})}),H&&(0,o.jsx)(e.Positioned,{bottom:40,left:20,right:20,children:(0,o.jsxs)(e.Column,{children:[(0,o.jsx)(e.Container,{margin:{bottom:10},padding:4,decoration:{color:"#00000080",borderRadius:4},alignment:"center",children:(0,o.jsx)(e.Text,{text:`FPS: ${T}`,color:"#00FF00",fontSize:12})}),(0,o.jsx)(e.Container,{padding:12,decoration:{color:"#00000080",borderRadius:30},children:(0,o.jsxs)(e.Row,{mainAxisAlignment:"spaceEvenly",children:[(0,o.jsx)(e.GestureDetector,{onTap:pt,children:(0,o.jsx)(e.Container,{padding:8,children:(0,o.jsx)(e.Icon,{name:"arrow_back",size:24,color:"#FFFFFF"})})}),(0,o.jsx)(e.GestureDetector,{onTap:yt,children:(0,o.jsx)(e.Container,{padding:8,children:(0,o.jsx)(e.Icon,{name:"home",size:24,color:"#FFFFFF"})})}),(0,o.jsx)(e.GestureDetector,{onTap:ft,children:(0,o.jsx)(e.Container,{padding:8,children:(0,o.jsx)(e.Icon,{name:"apps",size:24,color:"#FFFFFF"})})}),(0,o.jsx)(e.GestureDetector,{onTap:()=>q(!1),children:(0,o.jsx)(e.Container,{padding:8,children:(0,o.jsx)(e.Icon,{name:"close",size:24,color:"#FFFFFF"})})})]})})]})}),!H&&(0,o.jsx)(e.Positioned,{bottom:40,right:20,children:(0,o.jsx)(e.GestureDetector,{onTap:()=>q(!0),children:(0,o.jsx)(e.Container,{width:50,height:50,decoration:{color:"#1976D2",borderRadius:25,boxShadow:{color:"#00000040",blurRadius:8,offset:{dx:0,dy:4}}},alignment:"center",children:(0,o.jsx)(e.Icon,{name:"settings",size:24,color:"#FFFFFF"})})})})]})})}var D=S(O()),n=S(_());var I=class{static async getDeviceInfo(){return await globalThis.dartCallNative("NetworkDiscovery.getDeviceInfo",{})}static async getLocalIp(){return await globalThis.dartCallNative("NetworkDiscovery.getLocalIp",{})}static async connectSignaling(t){return await globalThis.dartCallNativeAsync("Signaling.connect",{role:t})}static async getDeviceId(){return await globalThis.dartCallNativeAsync("Signaling.getDeviceId",{})}static async connectToDevice(t){return await globalThis.dartCallNativeAsync("Signaling.connectToDevice",{targetId:t})}static async disconnectSignaling(){return await globalThis.dartCallNativeAsync("Signaling.disconnect",{})}};var U=class{static async getString(t){return await globalThis.dartCallNativeAsync("Storage.getString",{key:t})}static async setString(t,s){return await globalThis.dartCallNativeAsync("Storage.setString",{key:t,value:s})}static async remove(t){return await globalThis.dartCallNativeAsync("Storage.remove",{key:t})}};var r=S(Y()),u={primary:"#2563EB",primaryDark:"#1E40AF",secondary:"#64748B",background:"#F8FAFC",surface:"#FFFFFF",textPrimary:"#1E293B",textSecondary:"#64748B",success:"#10B981",error:"#EF4444",divider:"#E2E8F0"};function tt(){let i=(0,n.useNavigator)(),[t,s]=(0,D.useState)(""),[a,c]=(0,D.useState)("Loading..."),[w,m]=(0,D.useState)("Initializing..."),[l,N]=(0,D.useState)(!1),[x,G]=(0,D.useState)(!1);(0,D.useEffect)(()=>{d(),V();let T=C.onClientConnected(async B=>{if(B.status==="connected"){G(!0),m("Remote Controller Connected");try{await new Promise(z=>setTimeout(z,500)),await W.startCapture({quality:40,maxWidth:720,maxHeight:1280,frameRate:20})}catch(z){console.error("Failed to start screen capture:",z),m("Failed to start capture")}}else B.status==="disconnected"&&(G(!1),m("Ready to Connect"))});return()=>{T(),I.disconnectSignaling()}},[]);let d=async()=>{if(m("Connecting to Cloud..."),await I.connectSignaling("controller")){let B=await I.getDeviceId();c(B),m("Ready to Connect")}else m("Network Error")},V=async()=>{let T=await U.getString("lastTargetId");T&&s(T)},H=async()=>{if(!t||t.length<6){m("Invalid ID");return}N(!0),m(`Connecting to ${t}...`),await U.setString("lastTargetId",t);try{await I.connectToDevice(t)?(i.push("/controller/control",{device:{ip:"P2P",name:`Device ${t}`,id:t}}),N(!1),m("Ready")):(m("Connection Request Failed"),N(!1))}catch(T){console.error("Connect error:",T),m("Error Connecting"),N(!1)}},q=async()=>{await C.disconnect(),G(!1),m("Ready to Connect")};return(0,r.jsx)(n.Scaffold,{backgroundColor:u.background,appBar:(0,r.jsx)(n.AppBar,{title:"AnyLink",centerTitle:!0,backgroundColor:u.primary,elevation:0,actions:[(0,r.jsx)(n.GestureDetector,{onTap:()=>{console.log("Settings tapped")}})]}),children:(0,r.jsxs)(n.Column,{padding:20,crossAxisAlignment:"stretch",children:[(0,r.jsxs)(n.Container,{padding:24,decoration:{color:u.surface,borderRadius:16,boxShadow:{color:"#0000000D",offset:{dx:0,dy:4},blurRadius:12}},margin:{bottom:24},children:[(0,r.jsxs)(n.Row,{mainAxisAlignment:"spaceBetween",crossAxisAlignment:"center",children:[(0,r.jsxs)(n.Column,{crossAxisAlignment:"start",children:[(0,r.jsx)(n.Text,{text:"Your ID",fontSize:14,fontWeight:"bold",color:u.textSecondary,margin:{bottom:4}}),(0,r.jsx)(n.Text,{text:a,fontSize:32,fontWeight:"900",color:u.textPrimary,letterSpacing:1.2})]}),(0,r.jsx)(n.GestureDetector,{onTap:()=>C.copyToClipboard(a),children:(0,r.jsx)(n.Container,{padding:12,decoration:{color:"#F1F5F9",borderRadius:12},children:(0,r.jsx)(n.Icon,{name:"content_copy",size:24,color:u.primary})})})]}),(0,r.jsx)(n.Container,{margin:{top:16},padding:{vertical:8,horizontal:12},decoration:{color:"#EFF6FF",borderRadius:8},children:(0,r.jsxs)(n.Row,{children:[(0,r.jsx)(n.Icon,{name:"info_outline",size:16,color:u.primary}),(0,r.jsx)(n.SizedBox,{width:8}),(0,r.jsx)(n.Text,{text:"Share this ID to allow remote access.",fontSize:12,color:u.primaryDark})]})})]}),(0,r.jsxs)(n.Container,{padding:24,decoration:{color:u.surface,borderRadius:16,boxShadow:{color:"#0000000D",offset:{dx:0,dy:4},blurRadius:12}},children:[(0,r.jsx)(n.Text,{text:"Control Remote Device",fontSize:18,fontWeight:"bold",color:u.textPrimary,margin:{bottom:20}}),(0,r.jsx)(n.Container,{decoration:{color:"#F1F5F9",borderRadius:12,border:{width:1,color:u.divider}},padding:{horizontal:16,vertical:4},margin:{bottom:20},children:(0,r.jsx)(n.TextField,{text:t,hintText:"Enter Partner ID",onChanged:s,keyboardType:"number",maxLines:1,style:{fontSize:18,color:u.textPrimary}})}),(0,r.jsx)(n.GestureDetector,{onTap:l?()=>{}:H,children:(0,r.jsx)(n.Container,{height:56,decoration:{color:l?u.secondary:u.primary,borderRadius:12,boxShadow:{color:l?"transparent":"#2563EB4D",offset:{dx:0,dy:4},blurRadius:8}},alignment:"center",children:l?(0,r.jsxs)(n.Row,{mainAxisAlignment:"center",children:[(0,r.jsx)(n.CircularProgressIndicator,{color:"#FFFFFF",size:20}),(0,r.jsx)(n.SizedBox,{width:12}),(0,r.jsx)(n.Text,{text:"Connecting...",color:"#FFFFFF",fontSize:16,fontWeight:"bold"})]}):(0,r.jsx)(n.Text,{text:"Connect",color:"#FFFFFF",fontSize:18,fontWeight:"bold"})})})]}),(0,r.jsx)(n.Container,{alignment:"center",margin:{top:32},children:(0,r.jsxs)(n.Row,{mainAxisAlignment:"center",children:[(0,r.jsx)(n.Container,{width:8,height:8,decoration:{color:w.includes("Ready")?u.success:w.includes("Error")?u.error:u.secondary,borderRadius:4},margin:{right:8}}),(0,r.jsx)(n.Text,{text:w,color:u.textSecondary,fontSize:14})]})}),(0,r.jsx)(n.Container,{alignment:"center",margin:{top:20},children:(0,r.jsx)(n.Text,{text:"v1.0.0",color:"#CBD5E1",fontSize:12})}),x&&(0,r.jsx)(n.GestureDetector,{onTap:q,children:(0,r.jsx)(n.Container,{padding:{horizontal:32,vertical:16},decoration:{color:u.error,borderRadius:30,boxShadow:{color:"#EF444466",offset:{dx:0,dy:4},blurRadius:12}},children:(0,r.jsxs)(n.Row,{children:[(0,r.jsx)(n.Icon,{name:"stop_circle",size:24,color:"#FFFFFF"}),(0,r.jsx)(n.SizedBox,{width:12}),(0,r.jsx)(n.Text,{text:"Stop Sharing",color:"#FFFFFF",fontSize:18,fontWeight:"bold"})]})})})]})})}var Dt=i=>P.default.createElement(zt,{error:i}),zt=({error:i})=>{let t=(0,h.useNavigator)();return P.default.createElement(h.Container,{color:"#FFEBEE"},P.default.createElement(h.Column,{mainAxisAlignment:"center",crossAxisAlignment:"center",padding:30},P.default.createElement(h.Text,{text:"Error Occurred",fontSize:22,color:"#C62828",fontWeight:"bold",margin:{bottom:16}}),P.default.createElement(h.Container,{padding:12,decoration:{color:"#FFFFFF",borderRadius:8,border:{width:1,color:"#FFCDD2"}},margin:{bottom:20}},P.default.createElement(h.Text,{text:i?.message||"Unknown Error",fontSize:14,color:"#D32F2F",maxLines:5,overflow:"ellipsis"})),P.default.createElement(h.Button,{text:"Back to Home",onTap:()=>t.push("/")})))};function et(){try{h.Runtime.bindGlobals(),(0,h.setGlobalErrorFallback)(Dt),h.Router.register("/",i=>P.default.createElement(tt,i)),h.Router.register("/controller/control",i=>P.default.createElement(Z,i))}catch(i){console.error("[RemoteControl] Init error:",i)}}globalThis.initApp=et;et();})();
/*! Bundled license information:

react/cjs/react-jsx-runtime.production.min.js:
  (**
   * @license React
   * react-jsx-runtime.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)
*/
