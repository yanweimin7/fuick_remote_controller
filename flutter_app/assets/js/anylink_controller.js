"use strict";(()=>{var fe=Object.create;var ie=Object.defineProperty;var ye=Object.getOwnPropertyDescriptor;var be=Object.getOwnPropertyNames;var we=Object.getPrototypeOf,Se=Object.prototype.hasOwnProperty;var X=(a,e)=>()=>(e||a((e={exports:{}}).exports,e),e.exports);var Ae=(a,e,s,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let c of be(e))!Se.call(a,c)&&c!==s&&ie(a,c,{get:()=>e[c],enumerable:!(i=ye(e,c))||i.enumerable});return a};var S=(a,e,s)=>(s=a!=null?fe(we(a)):{},Ae(e||!a||!a.__esModule?ie(s,"default",{value:a,enumerable:!0}):s,a));var O=X((Be,ae)=>{ae.exports=globalThis.React});var _=X((_e,se)=>{se.exports=globalThis.FuickFramework});var le=X(M=>{"use strict";var xe=O(),ve=Symbol.for("react.element"),Te=Symbol.for("react.fragment"),Pe=Object.prototype.hasOwnProperty,Re=xe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ee={key:!0,ref:!0,__self:!0,__source:!0};function ce(a,e,s){var i,c={},w=null,u=null;s!==void 0&&(w=""+s),e.key!==void 0&&(w=""+e.key),e.ref!==void 0&&(u=e.ref);for(i in e)Pe.call(e,i)&&!Ee.hasOwnProperty(i)&&(c[i]=e[i]);if(a&&a.defaultProps)for(i in e=a.defaultProps,e)c[i]===void 0&&(c[i]=e[i]);return{$$typeof:ve,type:a,key:w,ref:u,props:c,_owner:Re.current}}M.Fragment=Te;M.jsx=ce;M.jsxs=ce});var Y=X((Oe,de)=>{"use strict";de.exports=le()});var P=S(O()),h=S(_());var C=S(O()),t=S(_());var k=S(_()),f=class{static async disconnect(){return await globalThis.dartCallNativeAsync("Control.disconnect",{})===!0}static async isConnected(){return await globalThis.dartCallNative("Control.isConnected",{})===!0}static async sendClick(e,s){return await globalThis.dartCallNativeAsync("Control.sendClick",{x:e,y:s,duration:50})===!0}static async sendSwipe(e,s,i,c,w=300){return await globalThis.dartCallNativeAsync("Control.sendSwipe",{startX:e,startY:s,endX:i,endY:c,duration:w})===!0}static async sendBack(){return await globalThis.dartCallNativeAsync("Control.sendBack",{})===!0}static async sendHome(){return await globalThis.dartCallNativeAsync("Control.sendHome",{})===!0}static async sendRecent(){return await globalThis.dartCallNativeAsync("Control.sendRecent",{})===!0}static async sendLongPress(e,s,i=1e3){return await globalThis.dartCallNativeAsync("Control.sendLongPress",{x:e,y:s,duration:i})===!0}static async sendText(e){return await globalThis.dartCallNativeAsync("Control.sendText",{text:e})===!0}static async isAccessibilityEnabled(){return await globalThis.dartCallNativeAsync("Control.isAccessibilityEnabled",{})===!0}static async openAccessibilitySettings(){return await globalThis.dartCallNativeAsync("Control.openAccessibilitySettings",{})===!0}static async copyToClipboard(e){return await globalThis.dartCallNativeAsync("Control.copyToClipboard",{text:e})===!0}static onConnectionStateChange(e){let s=c=>e("connected",c),i=()=>e("disconnected");return k.NativeEvent.on("connected",s),k.NativeEvent.on("disconnected",i),()=>{k.NativeEvent.off("connected",s),k.NativeEvent.off("disconnected",i)}}static onClientConnected(e){let s=i=>e(i);return k.NativeEvent.on("onClientConnected",s),()=>{k.NativeEvent.off("onClientConnected",s)}}};var K=S(_()),W=class{static async startCapture(e){return await globalThis.dartCallNativeAsync("ScreenCapture.startCapture",{quality:80,maxWidth:1280,maxHeight:720,frameRate:30,...e})===!0}static async stopCapture(){return await globalThis.dartCallNativeAsync("ScreenCapture.stopCapture",{})}static onScreenFrame(e){let s=i=>{if(!i||!i.data)return;let c={data:`data:image/jpeg;base64,${i.data}`,timestamp:i.timestamp,width:i.width,height:i.height,originalWidth:i.originalWidth,originalHeight:i.originalHeight};e(c)};return K.NativeEvent.on("screen_frame",s),()=>{K.NativeEvent.off("screen_frame",s)}}};var L=class{static async startCall(e){return await globalThis.dartCallNativeAsync("WebRTC.startCall",{isCaller:e})}static async stopCall(){return await globalThis.dartCallNativeAsync("WebRTC.stopCall",{})}};var r=S(Y());function Z(a){let{device:e}=a,s=(0,t.useNavigator)(),[i,c]=(0,C.useState)(null),[w,u]=(0,C.useState)(null),[l,N]=(0,C.useState)({width:0,height:0}),[v,G]=(0,C.useState)({width:0,height:0}),[g,V]=(0,C.useState)({width:0,height:0}),[H,q]=(0,C.useState)(!0),[T,B]=(0,C.useState)(0),z=(0,C.useRef)({x:0,y:0}),ke=(0,C.useRef)(null),$=(0,C.useRef)(0),oe=(0,C.useRef)(Date.now());(0,C.useEffect)(()=>{let m=W.onScreenFrame(p=>{if(p.data){let A=p.data.replace(/[\r\n]/g,"");u(A)}$.current++;let F=Date.now();if(F-oe.current>=1e3&&(B($.current),$.current=0,oe.current=F),typeof p.width=="number"&&typeof p.height=="number"){let A=p.width,E=p.height;N(x=>x.width===A&&x.height===E?x:{width:A,height:E})}if(typeof p.originalWidth=="number"&&typeof p.originalHeight=="number"){let A=p.originalWidth,E=p.originalHeight;G(x=>x.width===A&&x.height===E?x:{width:A,height:E})}}),R=f.onConnectionStateChange((p,F)=>{p==="connected"?e?.ip!=="P2P"&&L.startCall(!0):(c("Connection Lost"),L.stopCall())});return()=>{m(),R(),L.stopCall(),f.disconnect()}},[e]);let ge=m=>{if(g.width&&g.height&&l.width&&l.height){let R=g.width/l.width,p=g.height/l.height,F=Math.min(R,p),A=l.width*F,E=l.height*F,x=(g.width-A)/2,j=(g.height-E)/2,Q=m.localPosition.dx,J=m.localPosition.dy,y=(Q-x)/F,b=(J-j)/F;v.width&&v.height?(y=y*(v.width/l.width),b=b*(v.height/l.height)):(y=y*2,b=b*2),z.current={x:y,y:b}}},me=async m=>{if(g.width&&g.height&&l.width&&l.height){let R=g.width/l.width,p=g.height/l.height,F=Math.min(R,p),A=l.width*F,E=l.height*F,x=(g.width-A)/2,j=(g.height-E)/2,Q=m.localPosition.dx,J=m.localPosition.dy,y=(Q-x)/F,b=(J-j)/F;v.width&&v.height?(y=y*(v.width/l.width),b=b*(v.height/l.height)):(y=y*2,b=b*2);let ne=z.current.x,re=z.current.y;Math.sqrt(Math.pow(y-ne,2)+Math.pow(b-re,2))<10?await ue(y,b):await he(ne,re,y,b)}},ue=async(m,R)=>{await f.sendClick(m,R)},he=async(m,R,p,F)=>{await f.sendSwipe(m,R,p,F,300)},pe=()=>f.sendBack(),Fe=()=>f.sendHome(),Ce=()=>f.sendRecent();return i?(0,r.jsx)(t.Scaffold,{appBar:(0,r.jsx)(t.AppBar,{title:(0,r.jsx)(t.Text,{text:"Connection Error",fontSize:20,fontWeight:"bold",color:"#FFFFFF"}),leading:(0,r.jsx)(t.GestureDetector,{onTap:()=>s.pop(),children:(0,r.jsx)(t.Container,{padding:4,children:(0,r.jsx)(t.Icon,{name:"arrow_back",size:24,color:"#FFFFFF"})})}),backgroundColor:"#F44336"}),children:(0,r.jsx)(t.Container,{color:"#000000",children:(0,r.jsxs)(t.Column,{mainAxisAlignment:"center",crossAxisAlignment:"center",padding:32,children:[(0,r.jsx)(t.Icon,{name:"error",size:64,color:"#F44336"}),(0,r.jsx)(t.Text,{text:i,fontSize:16,color:"#FFFFFF",margin:{top:16}}),(0,r.jsx)(t.Button,{text:"Go Back",onTap:()=>s.pop(),margin:{top:24}}),(0,r.jsx)(t.Button,{text:"Load Test Image",onTap:()=>{u("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z8BQDwAEhQGAhKmMIQAAAABJRU5ErkJggg=="),c(null)},margin:{top:24}})]})})}):(0,r.jsx)(t.Scaffold,{appBar:H?(0,r.jsx)(t.AppBar,{title:(0,r.jsx)(t.Text,{text:e?.name||"AnyLink Remote",fontSize:20,fontWeight:"bold",color:"#FFFFFF"}),leading:(0,r.jsx)(t.GestureDetector,{onTap:()=>s.pop(),children:(0,r.jsx)(t.Container,{padding:4,children:(0,r.jsx)(t.Icon,{name:"arrow_back",size:24,color:"#FFFFFF"})})}),backgroundColor:"#2563EB"}):void 0,children:(0,r.jsxs)(t.Stack,{children:[(0,r.jsx)(t.Positioned,{left:0,right:0,top:0,bottom:0,children:(0,r.jsx)(t.Container,{color:"#000000",children:(0,r.jsx)(t.VisibilityDetector,{onVisibilityChanged:m=>{(m.size.width!==g.width||m.size.height!==g.height)&&V(m.size)},children:(0,r.jsx)(t.PointerListener,{onPointerDown:m=>ge(m),onPointerUp:m=>me(m),children:(0,r.jsx)(t.Container,{alignment:"center",width:g.width||300,height:g.height||600,color:"#333333",children:w?(0,r.jsx)(t.Stack,{children:(0,r.jsx)(t.Image,{url:w,fit:"contain",width:g.width||300,height:g.height||600})}):(0,r.jsxs)(t.Column,{mainAxisAlignment:"center",children:[(0,r.jsx)(t.CircularProgressIndicator,{color:"#2563EB"}),(0,r.jsx)(t.Text,{text:"Waiting for stream...",fontSize:14,color:"#888888",margin:{top:16}})]})})})})})}),H&&(0,r.jsx)(t.Positioned,{bottom:40,left:20,right:20,children:(0,r.jsxs)(t.Column,{children:[(0,r.jsx)(t.Container,{margin:{bottom:10},padding:4,decoration:{color:"#00000080",borderRadius:4},alignment:"center",children:(0,r.jsx)(t.Text,{text:`FPS: ${T}`,color:"#00FF00",fontSize:12})}),(0,r.jsx)(t.Container,{padding:12,decoration:{color:"#00000080",borderRadius:30},children:(0,r.jsxs)(t.Row,{mainAxisAlignment:"spaceEvenly",children:[(0,r.jsx)(t.GestureDetector,{onTap:pe,children:(0,r.jsx)(t.Container,{padding:8,children:(0,r.jsx)(t.Icon,{name:"arrow_back",size:24,color:"#FFFFFF"})})}),(0,r.jsx)(t.GestureDetector,{onTap:Fe,children:(0,r.jsx)(t.Container,{padding:8,children:(0,r.jsx)(t.Icon,{name:"home",size:24,color:"#FFFFFF"})})}),(0,r.jsx)(t.GestureDetector,{onTap:Ce,children:(0,r.jsx)(t.Container,{padding:8,children:(0,r.jsx)(t.Icon,{name:"apps",size:24,color:"#FFFFFF"})})}),(0,r.jsx)(t.GestureDetector,{onTap:()=>q(!1),children:(0,r.jsx)(t.Container,{padding:8,children:(0,r.jsx)(t.Icon,{name:"close",size:24,color:"#FFFFFF"})})})]})})]})}),!H&&(0,r.jsx)(t.Positioned,{bottom:40,right:20,children:(0,r.jsx)(t.GestureDetector,{onTap:()=>q(!0),children:(0,r.jsx)(t.Container,{width:50,height:50,decoration:{color:"#1976D2",borderRadius:25,boxShadow:{color:"#00000040",blurRadius:8,offset:{dx:0,dy:4}}},alignment:"center",children:(0,r.jsx)(t.Icon,{name:"settings",size:24,color:"#FFFFFF"})})})})]})})}var D=S(O()),o=S(_());var I=class{static async getDeviceInfo(){return await globalThis.dartCallNative("NetworkDiscovery.getDeviceInfo",{})}static async getLocalIp(){return await globalThis.dartCallNative("NetworkDiscovery.getLocalIp",{})}static async connectSignaling(e){return await globalThis.dartCallNativeAsync("Signaling.connect",{role:e})}static async getDeviceId(){return await globalThis.dartCallNativeAsync("Signaling.getDeviceId",{})}static async connectToDevice(e){return await globalThis.dartCallNativeAsync("Signaling.connectToDevice",{targetId:e})}static async disconnectSignaling(){return await globalThis.dartCallNativeAsync("Signaling.disconnect",{})}};var U=class{static async getString(e){return await globalThis.dartCallNativeAsync("Storage.getString",{key:e})}static async setString(e,s){return await globalThis.dartCallNativeAsync("Storage.setString",{key:e,value:s})}static async remove(e){return await globalThis.dartCallNativeAsync("Storage.remove",{key:e})}};var n=S(Y()),d={primary:"#2563EB",primaryDark:"#1E40AF",secondary:"#64748B",background:"#F8FAFC",surface:"#FFFFFF",textPrimary:"#1E293B",textSecondary:"#64748B",success:"#10B981",error:"#EF4444",divider:"#E2E8F0"};function ee(){let a=(0,o.useNavigator)(),[e,s]=(0,D.useState)(""),[i,c]=(0,D.useState)("Loading..."),[w,u]=(0,D.useState)("Initializing..."),[l,N]=(0,D.useState)(!1),[v,G]=(0,D.useState)(!1);(0,D.useEffect)(()=>{g(),V();let T=f.onClientConnected(async B=>{if(B.status==="connected"){G(!0),u("Remote Controller Connected");try{await new Promise(z=>setTimeout(z,500)),await W.startCapture({quality:40,maxWidth:720,maxHeight:1280,frameRate:20})}catch(z){console.error("Failed to start screen capture:",z),u("Failed to start capture")}}else B.status==="disconnected"&&(G(!1),u("Ready to Connect"))});return()=>{T(),I.disconnectSignaling()}},[]);let g=async()=>{if(u("Connecting to Cloud..."),await I.connectSignaling("controller")){let B=await I.getDeviceId();c(B),u("Ready to Connect")}else u("Network Error")},V=async()=>{let T=await U.getString("lastTargetId");T&&s(T)},H=async()=>{if(!e||e.length<6){u("Invalid ID");return}N(!0),u(`Connecting to ${e}...`),await U.setString("lastTargetId",e);try{await I.connectToDevice(e)?(a.push("/controller/control",{device:{ip:"P2P",name:`Device ${e}`,id:e}}),N(!1),u("Ready")):(u("Connection Request Failed"),N(!1))}catch(T){console.error("Connect error:",T),u("Error Connecting"),N(!1)}},q=async()=>{await f.disconnect(),G(!1),u("Ready to Connect")};return(0,n.jsx)(o.Scaffold,{backgroundColor:d.background,appBar:(0,n.jsx)(o.AppBar,{title:"AnyLink",centerTitle:!0,backgroundColor:d.primary,elevation:0,actions:[(0,n.jsx)(o.GestureDetector,{onTap:()=>{console.log("Settings tapped")},children:(0,n.jsx)(o.Container,{padding:16,children:(0,n.jsx)(o.Icon,{name:"settings",size:24,color:"#FFFFFF"})})})]}),children:(0,n.jsxs)(o.Stack,{fit:"expand",children:[(0,n.jsxs)(o.Column,{padding:20,crossAxisAlignment:"stretch",children:[(0,n.jsxs)(o.Container,{alignment:"center",margin:{bottom:24,top:10},children:[(0,n.jsx)(o.Icon,{name:"devices",size:64,color:d.primary}),(0,n.jsx)(o.Text,{text:"Seamless Remote Access",fontSize:14,color:d.textSecondary,margin:{top:8}})]}),(0,n.jsxs)(o.Container,{padding:24,decoration:{color:d.surface,borderRadius:16,boxShadow:{color:"#0000000D",offset:{dx:0,dy:4},blurRadius:12}},margin:{bottom:24},children:[(0,n.jsxs)(o.Row,{mainAxisAlignment:"spaceBetween",crossAxisAlignment:"center",children:[(0,n.jsxs)(o.Column,{crossAxisAlignment:"start",children:[(0,n.jsx)(o.Text,{text:"Your ID",fontSize:14,fontWeight:"bold",color:d.textSecondary,margin:{bottom:4}}),(0,n.jsx)(o.Text,{text:i,fontSize:32,fontWeight:"900",color:d.textPrimary,letterSpacing:1.2})]}),(0,n.jsx)(o.GestureDetector,{onTap:()=>f.copyToClipboard(i),children:(0,n.jsx)(o.Container,{padding:12,decoration:{color:"#F1F5F9",borderRadius:12},children:(0,n.jsx)(o.Icon,{name:"content_copy",size:24,color:d.primary})})})]}),(0,n.jsx)(o.Container,{margin:{top:16},padding:{vertical:8,horizontal:12},decoration:{color:"#EFF6FF",borderRadius:8},children:(0,n.jsxs)(o.Row,{children:[(0,n.jsx)(o.Icon,{name:"info_outline",size:16,color:d.primary}),(0,n.jsx)(o.SizedBox,{width:8}),(0,n.jsx)(o.Text,{text:"Share this ID to allow remote access.",fontSize:12,color:d.primaryDark})]})})]}),(0,n.jsxs)(o.Container,{padding:24,decoration:{color:d.surface,borderRadius:16,boxShadow:{color:"#0000000D",offset:{dx:0,dy:4},blurRadius:12}},children:[(0,n.jsx)(o.Text,{text:"Control Remote Device",fontSize:18,fontWeight:"bold",color:d.textPrimary,margin:{bottom:20}}),(0,n.jsx)(o.Container,{decoration:{color:"#F1F5F9",borderRadius:12,border:{width:1,color:d.divider}},padding:{horizontal:16,vertical:4},margin:{bottom:20},children:(0,n.jsx)(o.TextField,{text:e,hintText:"Enter Partner ID",onChanged:s,keyboardType:"number",maxLines:1,style:{fontSize:18,color:d.textPrimary}})}),(0,n.jsx)(o.GestureDetector,{onTap:l?()=>{}:H,children:(0,n.jsx)(o.Container,{height:56,decoration:{color:l?d.secondary:d.primary,borderRadius:12,boxShadow:{color:l?"transparent":"#2563EB4D",offset:{dx:0,dy:4},blurRadius:8}},alignment:"center",children:l?(0,n.jsxs)(o.Row,{mainAxisAlignment:"center",children:[(0,n.jsx)(o.CircularProgressIndicator,{color:"#FFFFFF",size:20}),(0,n.jsx)(o.SizedBox,{width:12}),(0,n.jsx)(o.Text,{text:"Connecting...",color:"#FFFFFF",fontSize:16,fontWeight:"bold"})]}):(0,n.jsx)(o.Text,{text:"Connect",color:"#FFFFFF",fontSize:18,fontWeight:"bold"})})})]}),(0,n.jsx)(o.Container,{alignment:"center",margin:{top:32},children:(0,n.jsxs)(o.Row,{mainAxisAlignment:"center",children:[(0,n.jsx)(o.Container,{width:8,height:8,decoration:{color:w.includes("Ready")?d.success:w.includes("Error")?d.error:d.secondary,borderRadius:4},margin:{right:8}}),(0,n.jsx)(o.Text,{text:w,color:d.textSecondary,fontSize:14})]})}),(0,n.jsx)(o.Container,{alignment:"center",margin:{top:20},children:(0,n.jsx)(o.Text,{text:"v1.0.0",color:"#CBD5E1",fontSize:12})})]}),v&&(0,n.jsx)(o.Positioned,{left:0,right:0,top:0,bottom:0,children:(0,n.jsx)(o.Container,{color:"#0F172ACC",alignment:"center",padding:30,children:(0,n.jsxs)(o.Column,{mainAxisAlignment:"center",crossAxisAlignment:"center",children:[(0,n.jsx)(o.Container,{padding:24,decoration:{color:"#FFFFFF20",borderRadius:100},margin:{bottom:32},children:(0,n.jsx)(o.Icon,{name:"screen_share",size:64,color:"#FFFFFF"})}),(0,n.jsx)(o.Text,{text:"Screen Sharing Active",color:"#FFFFFF",fontSize:24,fontWeight:"bold",margin:{bottom:12}}),(0,n.jsx)(o.Text,{text:"This device is being controlled remotely",color:"#94A3B8",fontSize:16,margin:{bottom:48}}),(0,n.jsx)(o.GestureDetector,{onTap:q,children:(0,n.jsx)(o.Container,{padding:{horizontal:32,vertical:16},decoration:{color:d.error,borderRadius:30,boxShadow:{color:"#EF444466",offset:{dx:0,dy:4},blurRadius:12}},children:(0,n.jsxs)(o.Row,{children:[(0,n.jsx)(o.Icon,{name:"stop_circle",size:24,color:"#FFFFFF"}),(0,n.jsx)(o.SizedBox,{width:12}),(0,n.jsx)(o.Text,{text:"Stop Sharing",color:"#FFFFFF",fontSize:18,fontWeight:"bold"})]})})})]})})})]})})}var De=a=>P.default.createElement(ze,{error:a}),ze=({error:a})=>{let e=(0,h.useNavigator)();return P.default.createElement(h.Container,{color:"#FFEBEE"},P.default.createElement(h.Column,{mainAxisAlignment:"center",crossAxisAlignment:"center",padding:30},P.default.createElement(h.Text,{text:"Error Occurred",fontSize:22,color:"#C62828",fontWeight:"bold",margin:{bottom:16}}),P.default.createElement(h.Container,{padding:12,decoration:{color:"#FFFFFF",borderRadius:8,border:{width:1,color:"#FFCDD2"}},margin:{bottom:20}},P.default.createElement(h.Text,{text:a?.message||"Unknown Error",fontSize:14,color:"#D32F2F",maxLines:5,overflow:"ellipsis"})),P.default.createElement(h.Button,{text:"Back to Home",onTap:()=>e.push("/")})))};function te(){try{h.Runtime.bindGlobals(),(0,h.setGlobalErrorFallback)(De),h.Router.register("/",a=>P.default.createElement(ee,a)),h.Router.register("/controller/control",a=>P.default.createElement(Z,a))}catch(a){console.error("[RemoteControl] Init error:",a)}}globalThis.initApp=te;te();})();
/*! Bundled license information:

react/cjs/react-jsx-runtime.production.min.js:
  (**
   * @license React
   * react-jsx-runtime.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)
*/
