"use strict";(()=>{var Ft=Object.create;var st=Object.defineProperty;var wt=Object.getOwnPropertyDescriptor;var St=Object.getOwnPropertyNames;var At=Object.getPrototypeOf,xt=Object.prototype.hasOwnProperty;var j=(s,t)=>()=>(t||s((t={exports:{}}).exports,t),t.exports);var vt=(s,t,i,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let l of St(t))!xt.call(s,l)&&l!==i&&st(s,l,{get:()=>t[l],enumerable:!(a=wt(t,l))||a.enumerable});return s};var v=(s,t,i)=>(i=s!=null?Ft(At(s)):{},vt(t||!s||!s.__esModule?st(i,"default",{value:s,enumerable:!0}):i,s));var Y=j((Ht,ct)=>{ct.exports=globalThis.React});var G=j((Gt,lt)=>{lt.exports=globalThis.FuickFramework});var ut=j($=>{"use strict";var Tt=Y(),Pt=Symbol.for("react.element"),Et=Symbol.for("react.fragment"),Rt=Object.prototype.hasOwnProperty,Dt=Tt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,zt={key:!0,ref:!0,__self:!0,__source:!0};function dt(s,t,i){var a,l={},A=null,g=null;i!==void 0&&(A=""+i),t.key!==void 0&&(A=""+t.key),t.ref!==void 0&&(g=t.ref);for(a in t)Rt.call(t,a)&&!zt.hasOwnProperty(a)&&(l[a]=t[a]);if(s&&s.defaultProps)for(a in t=s.defaultProps,t)l[a]===void 0&&(l[a]=t[a]);return{$$typeof:Pt,type:s,key:A,ref:g,props:l,_owner:Dt.current}}$.Fragment=Et;$.jsx=dt;$.jsxs=dt});var U=j((Ut,gt)=>{"use strict";gt.exports=ut()});var E=v(Y()),m=v(G());var y=v(Y()),e=v(G());var D=v(G()),C=class{static async disconnect(){return await globalThis.dartCallNativeAsync("Control.disconnect",{})===!0}static async isConnected(){return await globalThis.dartCallNative("Control.isConnected",{})===!0}static async sendClick(t,i){return await globalThis.dartCallNativeAsync("Control.sendClick",{x:t,y:i,duration:50})===!0}static async sendSwipe(t,i,a,l,A=300){return await globalThis.dartCallNativeAsync("Control.sendSwipe",{startX:t,startY:i,endX:a,endY:l,duration:A})===!0}static async sendBack(){return await globalThis.dartCallNativeAsync("Control.sendBack",{})===!0}static async sendHome(){return await globalThis.dartCallNativeAsync("Control.sendHome",{})===!0}static async sendRecent(){return await globalThis.dartCallNativeAsync("Control.sendRecent",{})===!0}static async sendLongPress(t,i,a=1e3){return await globalThis.dartCallNativeAsync("Control.sendLongPress",{x:t,y:i,duration:a})===!0}static async sendText(t){return await globalThis.dartCallNativeAsync("Control.sendText",{text:t})===!0}static async isAccessibilityEnabled(){return await globalThis.dartCallNativeAsync("Control.isAccessibilityEnabled",{})===!0}static async openAccessibilitySettings(){return await globalThis.dartCallNativeAsync("Control.openAccessibilitySettings",{})===!0}static async copyToClipboard(t){return await globalThis.dartCallNativeAsync("Control.copyToClipboard",{text:t})===!0}static onConnectionStateChange(t){let i=l=>t("connected",l),a=()=>t("disconnected");return D.NativeEvent.on("connected",i),D.NativeEvent.on("disconnected",a),()=>{D.NativeEvent.off("connected",i),D.NativeEvent.off("disconnected",a)}}static onScreenInfo(t){let i=a=>t(a);return D.NativeEvent.on("screen_info",i),()=>{D.NativeEvent.off("screen_info",i)}}static onClientConnected(t){let i=a=>t(a);return D.NativeEvent.on("onClientConnected",i),()=>{D.NativeEvent.off("onClientConnected",i)}}};var tt=v(G()),L=class{static async startCapture(t={}){return await globalThis.dartCallNativeAsync("ScreenCapture.startCapture",{quality:90,maxWidth:1920,maxHeight:1080,frameRate:30,...t})===!0}static async stopCapture(){return await globalThis.dartCallNativeAsync("ScreenCapture.stopCapture",{})}static onScreenFrame(t){let i=a=>{if(!a||!a.data)return;let l={data:`data:image/jpeg;base64,${a.data}`,timestamp:a.timestamp,width:a.width,height:a.height,originalWidth:a.originalWidth,originalHeight:a.originalHeight};t(l)};return tt.NativeEvent.on("screen_frame",i),()=>{tt.NativeEvent.off("screen_frame",i)}}};var M=class{static async startCall(t,i){return await globalThis.dartCallNativeAsync("WebRTC.startCall",{isCaller:t,captureMode:i})}static async stopCall(){return await globalThis.dartCallNativeAsync("WebRTC.stopCall",{})}};var n=v(U()),It=s=>y.default.createElement("RTCVideoView",s);function et(s){let{device:t,captureMode:i}=s,a=i==="webrtc",l=(0,e.useNavigator)(),[A,g]=(0,y.useState)(null),[I,k]=(0,y.useState)(null),[h,H]=(0,y.useState)({width:0,height:0}),[F,X]=(0,y.useState)({width:0,height:0}),[d,Q]=(0,y.useState)({width:0,height:0}),[O,q]=(0,y.useState)(!0),[P,N]=(0,y.useState)(0),B=(0,y.useRef)({x:0,y:0}),Bt=(0,y.useRef)(null),J=(0,y.useRef)(0),rt=(0,y.useRef)(Date.now());(0,y.useEffect)(()=>{let u=L.onScreenFrame(c=>{if(c.data){let b=c.data.replace(/[\r\n]/g,"");k(b)}J.current++;let x=Date.now();if(x-rt.current>=1e3&&(N(J.current),J.current=0,rt.current=x),typeof c.width=="number"&&typeof c.height=="number"){let b=c.width,f=c.height;H(T=>T.width===b&&T.height===f?T:{width:b,height:f})}if(typeof c.originalWidth=="number"&&typeof c.originalHeight=="number"){let b=c.originalWidth,f=c.originalHeight;X(T=>T.width===b&&T.height===f?T:{width:b,height:f})}}),R=C.onScreenInfo(c=>{if(typeof c.width=="number"&&typeof c.height=="number"){let x=c.width,b=c.height;H(f=>f.width===x&&f.height===b?f:{width:x,height:b}),X(f=>f.width===x&&f.height===b?f:{width:x,height:b})}}),W=C.onConnectionStateChange((c,x)=>{c==="connected"?t?.ip!=="P2P"&&M.startCall(!0,i):(g("\u8FDE\u63A5\u4E2D\u65AD"),M.stopCall())});return()=>{u(),R(),W(),M.stopCall(),C.disconnect()}},[t,i]);let mt=u=>{if(d.width&&d.height&&h.width&&h.height){let R=d.width/h.width,W=d.height/h.height,c=Math.min(R,W),x=h.width*c,b=h.height*c,f=(d.width-x)/2,T=(d.height-b)/2,K=u.localPosition.dx,Z=u.localPosition.dy,w=(K-f)/c,S=(Z-T)/c;F.width&&F.height?(w=w*(F.width/h.width),S=S*(F.height/h.height)):(w=w*2,S=S*2),B.current={x:w,y:S}}},ht=async u=>{if(d.width&&d.height&&h.width&&h.height){let R=d.width/h.width,W=d.height/h.height,c=Math.min(R,W),x=h.width*c,b=h.height*c,f=(d.width-x)/2,T=(d.height-b)/2,K=u.localPosition.dx,Z=u.localPosition.dy,w=(K-f)/c,S=(Z-T)/c;F.width&&F.height?(w=w*(F.width/h.width),S=S*(F.height/h.height)):(w=w*2,S=S*2);let it=B.current.x,at=B.current.y;Math.sqrt(Math.pow(w-it,2)+Math.pow(S-at,2))<10?await pt(w,S):await ft(it,at,w,S)}},pt=async(u,R)=>{await C.sendClick(u,R)},ft=async(u,R,W,c)=>{await C.sendSwipe(u,R,W,c,300)},yt=()=>C.sendBack(),bt=()=>C.sendHome(),Ct=()=>C.sendRecent();return A?(0,n.jsx)(e.Scaffold,{appBar:(0,n.jsx)(e.AppBar,{title:(0,n.jsx)(e.Text,{text:"\u8FDE\u63A5\u9519\u8BEF",fontSize:20,fontWeight:"bold",color:"#FFFFFF"}),leading:(0,n.jsx)(e.GestureDetector,{onTap:()=>l.pop(),children:(0,n.jsx)(e.Container,{padding:4,children:(0,n.jsx)(e.Icon,{name:"arrow_back",size:24,color:"#FFFFFF"})})}),backgroundColor:"#F44336"}),children:(0,n.jsx)(e.Container,{color:"#000000",children:(0,n.jsxs)(e.Column,{mainAxisAlignment:"center",crossAxisAlignment:"center",padding:32,children:[(0,n.jsx)(e.Icon,{name:"error",size:64,color:"#F44336"}),(0,n.jsx)(e.Text,{text:A,fontSize:16,color:"#FFFFFF",margin:{top:16}}),(0,n.jsx)(e.Button,{text:"\u8FD4\u56DE",onTap:()=>l.pop(),margin:{top:24}}),(0,n.jsx)(e.Button,{text:"\u52A0\u8F7D\u6D4B\u8BD5\u56FE\u7247",onTap:()=>{k("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z8BQDwAEhQGAhKmMIQAAAABJRU5ErkJggg=="),g(null)},margin:{top:24}})]})})}):(0,n.jsx)(e.Scaffold,{backgroundColor:a?"transparent":void 0,appBar:O?(0,n.jsx)(e.AppBar,{title:(0,n.jsx)(e.Text,{text:t?.name||"AnyLink \u8FDC\u7A0B",fontSize:20,fontWeight:"bold",color:"#FFFFFF"}),leading:(0,n.jsx)(e.GestureDetector,{onTap:()=>l.pop(),children:(0,n.jsx)(e.Container,{padding:4,children:(0,n.jsx)(e.Icon,{name:"arrow_back",size:24,color:"#FFFFFF"})})}),backgroundColor:"#2563EB"}):void 0,children:(0,n.jsxs)(e.Stack,{children:[(0,n.jsx)(e.Positioned,{left:0,right:0,top:0,bottom:0,children:(0,n.jsx)(e.Container,{color:a?"transparent":"#000000",children:(0,n.jsx)(e.VisibilityDetector,{onVisibilityChanged:u=>{(u.size.width!==d.width||u.size.height!==d.height)&&Q(u.size)},children:(0,n.jsx)(e.PointerListener,{onPointerDown:u=>mt(u),onPointerUp:u=>ht(u),children:(0,n.jsx)(e.Container,{alignment:"center",width:d.width||300,height:d.height||600,color:a?"transparent":"#333333",children:a?(0,n.jsx)(It,{objectFit:"contain",mirror:!1}):I?(0,n.jsx)(e.Stack,{children:(0,n.jsx)(e.Image,{url:I,fit:"contain",width:d.width||300,height:d.height||600})}):(0,n.jsxs)(e.Column,{mainAxisAlignment:"center",children:[(0,n.jsx)(e.CircularProgressIndicator,{color:"#2563EB"}),(0,n.jsx)(e.Text,{text:"\u7B49\u5F85\u753B\u9762...",fontSize:14,color:"#888888",margin:{top:16}})]})})})})})}),O&&(0,n.jsx)(e.Positioned,{bottom:40,left:20,right:20,children:(0,n.jsxs)(e.Column,{children:[(0,n.jsx)(e.Container,{margin:{bottom:10},padding:4,decoration:{color:"#00000080",borderRadius:4},alignment:"center",children:(0,n.jsx)(e.Text,{text:`FPS: ${P}`,color:"#00FF00",fontSize:12})}),(0,n.jsx)(e.Container,{padding:12,decoration:{color:"#00000080",borderRadius:30},children:(0,n.jsxs)(e.Row,{mainAxisAlignment:"spaceEvenly",children:[(0,n.jsx)(e.GestureDetector,{onTap:yt,children:(0,n.jsx)(e.Container,{padding:8,children:(0,n.jsx)(e.Icon,{name:"arrow_back",size:24,color:"#FFFFFF"})})}),(0,n.jsx)(e.GestureDetector,{onTap:bt,children:(0,n.jsx)(e.Container,{padding:8,children:(0,n.jsx)(e.Icon,{name:"home",size:24,color:"#FFFFFF"})})}),(0,n.jsx)(e.GestureDetector,{onTap:Ct,children:(0,n.jsx)(e.Container,{padding:8,children:(0,n.jsx)(e.Icon,{name:"apps",size:24,color:"#FFFFFF"})})}),(0,n.jsx)(e.GestureDetector,{onTap:()=>q(!1),children:(0,n.jsx)(e.Container,{padding:8,children:(0,n.jsx)(e.Icon,{name:"close",size:24,color:"#FFFFFF"})})})]})})]})}),!O&&(0,n.jsx)(e.Positioned,{bottom:40,right:20,children:(0,n.jsx)(e.GestureDetector,{onTap:()=>q(!0),children:(0,n.jsx)(e.Container,{width:50,height:50,decoration:{color:"#1976D2",borderRadius:25,boxShadow:{color:"#00000040",blurRadius:8,offset:{dx:0,dy:4}}},alignment:"center",children:(0,n.jsx)(e.Icon,{name:"settings",size:24,color:"#FFFFFF"})})})})]})})}var z=v(Y()),o=v(G());var _=class{static async getDeviceInfo(){return await globalThis.dartCallNative("NetworkDiscovery.getDeviceInfo",{})}static async getLocalIp(){return await globalThis.dartCallNative("NetworkDiscovery.getLocalIp",{})}static async connectSignaling(t){return await globalThis.dartCallNativeAsync("Signaling.connect",{role:t})}static async getDeviceId(){return await globalThis.dartCallNativeAsync("Signaling.getDeviceId",{})}static async connectToDevice(t,i){return await globalThis.dartCallNativeAsync("Signaling.connectToDevice",{targetId:t,captureMode:i})}static async disconnectSignaling(){return await globalThis.dartCallNativeAsync("Signaling.disconnect",{})}};var V=class{static async getString(t){return await globalThis.dartCallNativeAsync("Storage.getString",{key:t})}static async setString(t,i){return await globalThis.dartCallNativeAsync("Storage.setString",{key:t,value:i})}static async remove(t){return await globalThis.dartCallNativeAsync("Storage.remove",{key:t})}};var r=v(U()),p={primary:"#2563EB",primaryDark:"#1E40AF",secondary:"#64748B",background:"#F8FAFC",surface:"#FFFFFF",textPrimary:"#1E293B",textSecondary:"#64748B",success:"#10B981",error:"#EF4444",divider:"#E2E8F0"};function ot(){let s=(0,o.useNavigator)(),[t,i]=(0,z.useState)(""),[a,l]=(0,z.useState)("\u52A0\u8F7D\u4E2D..."),[A,g]=(0,z.useState)("\u521D\u59CB\u5316\u4E2D..."),[I,k]=(0,z.useState)(!1),[h,H]=(0,z.useState)(!1),[F,X]=(0,z.useState)("webrtc");(0,z.useEffect)(()=>{d(),Q();let P=C.onClientConnected(async N=>{if(N.status==="connected")if(H(!0),g("\u8FDC\u7A0B\u63A7\u5236\u5DF2\u8FDE\u63A5"),N.captureMode==="webrtc")console.log("WebRTC Capture Mode active. Skipping manual capture.");else try{await new Promise(B=>setTimeout(B,500)),await L.startCapture({quality:40,maxWidth:720,maxHeight:1280,frameRate:20})}catch(B){console.error("Failed to start screen capture:",B),g("\u542F\u52A8\u5F55\u5C4F\u5931\u8D25")}else N.status==="disconnected"&&(H(!1),g("\u51C6\u5907\u8FDE\u63A5"))});return()=>{P(),_.disconnectSignaling()}},[]);let d=async()=>{if(g("\u6B63\u5728\u8FDE\u63A5\u4E91\u7AEF..."),await _.connectSignaling("controller")){let N=await _.getDeviceId();l(N),g("\u51C6\u5907\u8FDE\u63A5")}else g("\u7F51\u7EDC\u9519\u8BEF")},Q=async()=>{let P=await V.getString("lastTargetId");P&&i(P)},O=async()=>{if(!t||t.length<6){g("ID \u65E0\u6548");return}k(!0),g(`\u6B63\u5728\u8FDE\u63A5\u5230 ${t}...`),await V.setString("lastTargetId",t);try{await _.connectToDevice(t,F)?(s.push("/controller/control",{device:{ip:"P2P",name:`\u8BBE\u5907 ${t}`,id:t},captureMode:F}),k(!1),g("\u5C31\u7EEA")):(g("\u8FDE\u63A5\u8BF7\u6C42\u5931\u8D25"),k(!1))}catch(P){console.error("Connect error:",P),g("\u8FDE\u63A5\u9519\u8BEF"),k(!1)}},q=async()=>{await C.disconnect(),H(!1),g("\u51C6\u5907\u8FDE\u63A5")};return(0,r.jsx)(o.Scaffold,{backgroundColor:p.background,appBar:(0,r.jsx)(o.AppBar,{title:"AnyLink",centerTitle:!0,backgroundColor:p.primary,elevation:0,actions:[(0,r.jsx)(o.GestureDetector,{onTap:()=>X(F==="webrtc"?"manual":"webrtc"),children:(0,r.jsx)(o.Container,{padding:16,children:(0,r.jsx)(o.Row,{children:(0,r.jsx)(o.Text,{text:F==="webrtc"?"\u6807\u51C6\u6A21\u5F0F":"\u517C\u5BB9\u6A21\u5F0F",color:"#FFFFFF",fontSize:14,fontWeight:"bold",margin:{right:8}})})})})]}),children:(0,r.jsxs)(o.Column,{padding:20,crossAxisAlignment:"stretch",children:[(0,r.jsxs)(o.Container,{padding:24,decoration:{color:p.surface,borderRadius:16,boxShadow:{color:"#0000000D",offset:{dx:0,dy:4},blurRadius:12}},margin:{bottom:24},children:[(0,r.jsxs)(o.Row,{mainAxisAlignment:"spaceBetween",crossAxisAlignment:"center",children:[(0,r.jsxs)(o.Column,{crossAxisAlignment:"start",children:[(0,r.jsx)(o.Text,{text:"\u60A8\u7684 ID",fontSize:14,fontWeight:"bold",color:p.textSecondary,margin:{bottom:4}}),(0,r.jsx)(o.Text,{text:a,fontSize:32,fontWeight:"w900",color:p.textPrimary})]}),(0,r.jsx)(o.GestureDetector,{onTap:()=>C.copyToClipboard(a),children:(0,r.jsx)(o.Container,{padding:12,decoration:{color:"#F1F5F9",borderRadius:12},children:(0,r.jsx)(o.Icon,{name:"content_copy",size:24,color:p.primary})})})]}),(0,r.jsx)(o.Container,{margin:{top:16},padding:{vertical:8,horizontal:12},decoration:{color:"#EFF6FF",borderRadius:8},children:(0,r.jsxs)(o.Row,{children:[(0,r.jsx)(o.Icon,{name:"info_outline",size:16,color:p.primary}),(0,r.jsx)(o.SizedBox,{width:8}),(0,r.jsx)(o.Text,{text:"\u5206\u4EAB\u6B64 ID \u4EE5\u5141\u8BB8\u8FDC\u7A0B\u8BBF\u95EE\u3002",fontSize:12,color:p.primaryDark})]})})]}),(0,r.jsxs)(o.Container,{padding:24,decoration:{color:p.surface,borderRadius:16,boxShadow:{color:"#0000000D",offset:{dx:0,dy:4},blurRadius:12}},children:[(0,r.jsx)(o.Text,{text:"\u63A7\u5236\u8FDC\u7A0B\u8BBE\u5907",fontSize:18,fontWeight:"bold",color:p.textPrimary,margin:{bottom:20}}),(0,r.jsx)(o.Container,{decoration:{color:"#F1F5F9",borderRadius:12,border:{width:1,color:p.divider}},padding:{horizontal:16,vertical:4},margin:{bottom:20},children:(0,r.jsx)(o.TextField,{text:t,hintText:"\u8F93\u5165\u4F19\u4F34 ID",onChanged:i,keyboardType:"number",maxLines:1})}),(0,r.jsx)(o.GestureDetector,{onTap:I?()=>{}:O,children:(0,r.jsx)(o.Container,{height:56,decoration:{color:I?p.secondary:p.primary,borderRadius:12,boxShadow:{color:I?"transparent":"#2563EB4D",offset:{dx:0,dy:4},blurRadius:8}},alignment:"center",children:I?(0,r.jsxs)(o.Row,{mainAxisAlignment:"center",children:[(0,r.jsx)(o.SizedBox,{width:20,height:20,children:(0,r.jsx)(o.CircularProgressIndicator,{color:"#FFFFFF"})}),(0,r.jsx)(o.SizedBox,{width:12}),(0,r.jsx)(o.Text,{text:"\u8FDE\u63A5\u4E2D...",color:"#FFFFFF",fontSize:16,fontWeight:"bold"})]}):(0,r.jsx)(o.Text,{text:"\u8FDE\u63A5",color:"#FFFFFF",fontSize:18,fontWeight:"bold"})})})]}),(0,r.jsx)(o.Container,{alignment:"center",margin:{top:32},children:(0,r.jsxs)(o.Row,{mainAxisAlignment:"center",children:[(0,r.jsx)(o.Container,{width:8,height:8,decoration:{color:A.includes("Ready")?p.success:A.includes("Error")?p.error:p.secondary,borderRadius:4},margin:{right:8}}),(0,r.jsx)(o.Text,{text:A,color:p.textSecondary,fontSize:14})]})}),(0,r.jsx)(o.Container,{alignment:"center",margin:{top:20},children:(0,r.jsx)(o.Text,{text:"v1.0.0",color:"#CBD5E1",fontSize:12})}),h&&(0,r.jsx)(o.GestureDetector,{onTap:q,children:(0,r.jsx)(o.Container,{padding:{horizontal:32,vertical:16},decoration:{color:p.error,borderRadius:30,boxShadow:{color:"#EF444466",offset:{dx:0,dy:4},blurRadius:12}},children:(0,r.jsxs)(o.Row,{children:[(0,r.jsx)(o.Icon,{name:"stop_circle",size:24,color:"#FFFFFF"}),(0,r.jsx)(o.SizedBox,{width:12}),(0,r.jsx)(o.Text,{text:"\u505C\u6B62\u5171\u4EAB",color:"#FFFFFF",fontSize:18,fontWeight:"bold"})]})})})]})})}var kt=s=>E.default.createElement(Nt,{error:s}),Nt=({error:s})=>{let t=(0,m.useNavigator)();return E.default.createElement(m.Container,{color:"#FFEBEE"},E.default.createElement(m.Column,{mainAxisAlignment:"center",crossAxisAlignment:"center",padding:30},E.default.createElement(m.Text,{text:"Error Occurred",fontSize:22,color:"#C62828",fontWeight:"bold",margin:{bottom:16}}),E.default.createElement(m.Container,{padding:12,decoration:{color:"#FFFFFF",borderRadius:8,border:{width:1,color:"#FFCDD2"}},margin:{bottom:20}},E.default.createElement(m.Text,{text:s?.message||"Unknown Error",fontSize:14,color:"#D32F2F",maxLines:5,overflow:"ellipsis"})),E.default.createElement(m.Button,{text:"Back to Home",onTap:()=>t.push("/")})))};function nt(){try{m.Runtime.bindGlobals(),(0,m.setGlobalErrorFallback)(kt),m.Router.register("/",s=>E.default.createElement(ot,s)),m.Router.register("/controller/control",s=>E.default.createElement(et,s))}catch(s){console.error("[RemoteControl] Init error:",s)}}globalThis.initApp=nt;nt();})();
/*! Bundled license information:

react/cjs/react-jsx-runtime.production.min.js:
  (**
   * @license React
   * react-jsx-runtime.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)
*/
