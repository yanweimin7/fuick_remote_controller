"use strict";(()=>{var xe=Object.create;var le=Object.defineProperty;var Se=Object.getOwnPropertyDescriptor;var Te=Object.getOwnPropertyNames;var Pe=Object.getPrototypeOf,ve=Object.prototype.hasOwnProperty;var $=(s,t)=>()=>(t||s((t={exports:{}}).exports,t),t.exports);var Ae=(s,t,a,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let c of Te(t))!ve.call(s,c)&&c!==a&&le(s,c,{get:()=>t[c],enumerable:!(i=Se(t,c))||i.enumerable});return s};var S=(s,t,a)=>(a=s!=null?xe(Pe(s)):{},Ae(t||!s||!s.__esModule?le(a,"default",{value:s,enumerable:!0}):a,s));var L=$((He,de)=>{de.exports=globalThis.React});var I=$((Ie,ue)=>{ue.exports=globalThis.FuickFramework});var ge=$(M=>{"use strict";var Ee=L(),ke=Symbol.for("react.element"),ze=Symbol.for("react.fragment"),De=Object.prototype.hasOwnProperty,Re=Ee.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ne={key:!0,ref:!0,__self:!0,__source:!0};function me(s,t,a){var i,c={},b=null,y=null;a!==void 0&&(b=""+a),t.key!==void 0&&(b=""+t.key),t.ref!==void 0&&(y=t.ref);for(i in t)De.call(t,i)&&!Ne.hasOwnProperty(i)&&(c[i]=t[i]);if(s&&s.defaultProps)for(i in t=s.defaultProps,t)c[i]===void 0&&(c[i]=t[i]);return{$$typeof:ke,type:s,key:b,ref:y,props:c,_owner:Re.current}}M.Fragment=ze;M.jsx=me;M.jsxs=me});var Y=$((qe,he)=>{"use strict";he.exports=ge()});var k=S(L()),u=S(I());var p=S(L()),e=S(I());var G=S(I()),f=class{static async disconnect(){return await globalThis.dartCallNativeAsync("Control.disconnect",{})===!0}static async isConnected(){return await globalThis.dartCallNative("Control.isConnected",{})===!0}static async sendClick(t,a){return await globalThis.dartCallNativeAsync("Control.sendClick",{x:t,y:a,duration:50})===!0}static async sendSwipe(t,a,i,c,b=300){return await globalThis.dartCallNativeAsync("Control.sendSwipe",{startX:t,startY:a,endX:i,endY:c,duration:b})===!0}static async sendBack(){return await globalThis.dartCallNativeAsync("Control.sendBack",{})===!0}static async sendHome(){return await globalThis.dartCallNativeAsync("Control.sendHome",{})===!0}static async sendRecent(){return await globalThis.dartCallNativeAsync("Control.sendRecent",{})===!0}static async sendLongPress(t,a,i=1e3){return await globalThis.dartCallNativeAsync("Control.sendLongPress",{x:t,y:a,duration:i})===!0}static async sendText(t){return await globalThis.dartCallNativeAsync("Control.sendText",{text:t})===!0}static async isAccessibilityEnabled(){return await globalThis.dartCallNativeAsync("Control.isAccessibilityEnabled",{})===!0}static async openAccessibilitySettings(){return await globalThis.dartCallNativeAsync("Control.openAccessibilitySettings",{})===!0}static async copyToClipboard(t){return await globalThis.dartCallNativeAsync("Control.copyToClipboard",{text:t})===!0}static onConnectionStateChange(t){let a=c=>t("connected",c),i=()=>t("disconnected");return G.NativeEvent.on("connected",a),G.NativeEvent.on("disconnected",i),()=>{G.NativeEvent.off("connected",a),G.NativeEvent.off("disconnected",i)}}static onClientConnected(t){let a=i=>t(i);return G.NativeEvent.on("onClientConnected",a),()=>{G.NativeEvent.off("onClientConnected",a)}}};var te=S(I()),A=class{static async startCapture(t){return await globalThis.dartCallNative("ScreenCapture.startCapture",{quality:80,maxWidth:1280,maxHeight:720,frameRate:30,...t})===!0}static async stopCapture(){return await globalThis.dartCallNative("ScreenCapture.stopCapture",{})===!0}static onScreenFrame(t){let a=i=>{if(!i)return;let c={data:i.data,timestamp:i.timestamp,width:i.width,height:i.height,originalWidth:i.originalWidth,originalHeight:i.originalHeight};t(c)};return te.NativeEvent.on("screen_frame",a),()=>{te.NativeEvent.off("screen_frame",a)}}};var P=class{static async startCall(t){return await globalThis.dartCallNativeAsync("WebRTC.startCall",{isCaller:t})}static async stopCall(){return await globalThis.dartCallNativeAsync("WebRTC.stopCall",{})}static async createOfferToken(){return await globalThis.dartCallNativeAsync("WebRTC.createOfferToken",{})}static async createAnswerToken(t){return await globalThis.dartCallNativeAsync("WebRTC.createAnswerToken",{offerToken:t})}static async completeConnection(t){return await globalThis.dartCallNativeAsync("WebRTC.completeConnection",{answerToken:t})}};var o=S(Y());function oe(s){let{device:t}=s,a=(0,e.useNavigator)(),[i,c]=(0,p.useState)(!0),[b,y]=(0,p.useState)(!1),[N,z]=(0,p.useState)(null),[W,_]=(0,p.useState)(null),[l,X]=(0,p.useState)({width:0,height:0}),[C,j]=(0,p.useState)({width:0,height:0}),[m,U]=(0,p.useState)({width:0,height:0}),[B,q]=(0,p.useState)(!0),[V,J]=(0,p.useState)(0),g=(0,p.useRef)({x:0,y:0}),H=(0,p.useRef)(null),K=(0,p.useRef)(0),ae=(0,p.useRef)(Date.now()),ie=async()=>{if(!t)return;await f.isConnected()?(y(!0),c(!1)):(c(!0),setTimeout(async()=>{await f.isConnected()||(z("\u8FDE\u63A5\u8D85\u65F6\uFF0C\u8BF7\u91CD\u8BD5"),c(!1))},3e4))};(0,p.useEffect)(()=>{t&&ie();let d=A.onScreenFrame(h=>{h.data&&_(h.data),K.current++;let F=Date.now();if(F-ae.current>=1e3&&(J(K.current),K.current=0,ae.current=F),typeof h.width=="number"&&typeof h.height=="number"){let D=h.width,R=h.height;X(T=>T.width===D&&T.height===R?T:{width:D,height:R})}if(typeof h.originalWidth=="number"&&typeof h.originalHeight=="number"){let D=h.originalWidth,R=h.originalHeight;j(T=>T.width===D&&T.height===R?T:{width:D,height:R})}}),v=f.onConnectionStateChange((h,F)=>{h==="connected"?(y(!0),c(!1),t?.ip!=="P2P"&&P.startCall(!0)):(y(!1),z("\u8FDE\u63A5\u5DF2\u65AD\u5F00"),P.stopCall())});return()=>{d(),v(),P.stopCall(),f.disconnect()}},[t]);let Ce=d=>{if(m.width&&m.height&&l.width&&l.height){let v=m.width/l.width,h=m.height/l.height,F=Math.min(v,h),D=l.width*F,R=l.height*F,T=(m.width-D)/2,Q=(m.height-R)/2,Z=d.localPosition.dx,ee=d.localPosition.dy,w=(Z-T)/F,x=(ee-Q)/F;C.width&&C.height?(w=w*(C.width/l.width),x=x*(C.height/l.height)):(w=w*2,x=x*2),g.current={x:w,y:x}}},pe=async d=>{if(m.width&&m.height&&l.width&&l.height){let v=m.width/l.width,h=m.height/l.height,F=Math.min(v,h),D=l.width*F,R=l.height*F,T=(m.width-D)/2,Q=(m.height-R)/2,Z=d.localPosition.dx,ee=d.localPosition.dy,w=(Z-T)/F,x=(ee-Q)/F;C.width&&C.height?(w=w*(C.width/l.width),x=x*(C.height/l.height)):(w=w*2,x=x*2);let se=g.current.x,ce=g.current.y;Math.sqrt(Math.pow(w-se,2)+Math.pow(x-ce,2))<10?await Fe(w,x):await fe(se,ce,w,x)}},Fe=async(d,v)=>{await f.sendClick(d,v)},fe=async(d,v,h,F)=>{await f.sendSwipe(d,v,h,F,300)},be=()=>f.sendBack(),ye=()=>f.sendHome(),we=()=>f.sendRecent();return i?(0,o.jsx)(e.Scaffold,{appBar:(0,o.jsx)(e.AppBar,{title:(0,o.jsx)(e.Text,{text:"\u6B63\u5728\u8FDE\u63A5...",fontSize:20,fontWeight:"bold",color:"#FFFFFF"}),leading:(0,o.jsx)(e.GestureDetector,{onTap:()=>a.pop(),children:(0,o.jsx)(e.Container,{padding:4,children:(0,o.jsx)(e.Icon,{name:"arrow_back",size:24,color:"#FFFFFF"})})}),backgroundColor:"#1976D2"}),children:(0,o.jsx)(e.Container,{color:"#000000",children:(0,o.jsxs)(e.Column,{mainAxisAlignment:"center",crossAxisAlignment:"center",children:[(0,o.jsx)(e.CircularProgressIndicator,{color:"#1976D2"}),(0,o.jsx)(e.Text,{text:"\u6B63\u5728\u8FDE\u63A5\u8BBE\u5907...",fontSize:16,color:"#FFFFFF",margin:{top:16}}),t&&(0,o.jsx)(e.Text,{text:`${t.name} (${t.ip})`,fontSize:12,color:"#888888",margin:{top:8}})]})})}):N?(0,o.jsx)(e.Scaffold,{appBar:(0,o.jsx)(e.AppBar,{title:(0,o.jsx)(e.Text,{text:"\u8FDE\u63A5\u51FA\u9519",fontSize:20,fontWeight:"bold",color:"#FFFFFF"}),leading:(0,o.jsx)(e.GestureDetector,{onTap:()=>a.pop(),children:(0,o.jsx)(e.Container,{padding:4,children:(0,o.jsx)(e.Icon,{name:"arrow_back",size:24,color:"#FFFFFF"})})}),backgroundColor:"#F44336"}),children:(0,o.jsx)(e.Container,{color:"#000000",children:(0,o.jsxs)(e.Column,{mainAxisAlignment:"center",crossAxisAlignment:"center",padding:32,children:[(0,o.jsx)(e.Icon,{name:"error",size:64,color:"#F44336"}),(0,o.jsx)(e.Text,{text:N,fontSize:16,color:"#FFFFFF",margin:{top:16}}),(0,o.jsx)(e.Button,{text:"\u91CD\u65B0\u8FDE\u63A5",onTap:ie,margin:{top:24}})]})})}):(0,o.jsx)(e.Scaffold,{appBar:B?(0,o.jsx)(e.AppBar,{title:(0,o.jsx)(e.Text,{text:t?.name||"\u8FDC\u7A0B\u63A7\u5236",fontSize:20,fontWeight:"bold",color:"#FFFFFF"}),leading:(0,o.jsx)(e.GestureDetector,{onTap:()=>a.pop(),children:(0,o.jsx)(e.Container,{padding:4,children:(0,o.jsx)(e.Icon,{name:"arrow_back",size:24,color:"#FFFFFF"})})}),backgroundColor:"#1976D2"}):void 0,children:(0,o.jsxs)(e.Stack,{children:[(0,o.jsx)(e.Container,{color:"#000000",children:(0,o.jsx)(e.VisibilityDetector,{onVisibilityChanged:d=>{(d.size.width!==m.width||d.size.height!==m.height)&&(U(d.size),console.log(`[TS] Local size updated: ${d.size.width}x${d.size.height}`))},children:(0,o.jsx)(e.PointerListener,{onPointerDown:d=>Ce(d),onPointerUp:d=>pe(d),children:(0,o.jsx)(e.Container,{alignment:"center",children:W?(0,o.jsx)(e.Image,{url:`data:image/jpeg;base64,${W}`,fit:"contain"}):(0,o.jsxs)(e.Column,{mainAxisAlignment:"center",children:[(0,o.jsx)(e.CircularProgressIndicator,{color:"#1976D2"}),(0,o.jsx)(e.Text,{text:"\u7B49\u5F85\u753B\u9762...",fontSize:14,color:"#888888",margin:{top:16}})]})})})})}),B&&(0,o.jsx)(e.Positioned,{bottom:40,left:20,right:20,children:(0,o.jsxs)(e.Column,{children:[(0,o.jsx)(e.Container,{margin:{bottom:10},padding:4,decoration:{color:"#00000080",borderRadius:4},alignment:"center",children:(0,o.jsx)(e.Text,{text:`FPS: ${V}`,color:"#00FF00",fontSize:12})}),(0,o.jsx)(e.Container,{padding:12,decoration:{color:"#00000080",borderRadius:30},children:(0,o.jsxs)(e.Row,{mainAxisAlignment:"spaceEvenly",children:[(0,o.jsx)(e.GestureDetector,{onTap:be,children:(0,o.jsx)(e.Container,{padding:8,children:(0,o.jsx)(e.Icon,{name:"arrow_back",size:24,color:"#FFFFFF"})})}),(0,o.jsx)(e.GestureDetector,{onTap:ye,children:(0,o.jsx)(e.Container,{padding:8,children:(0,o.jsx)(e.Icon,{name:"home",size:24,color:"#FFFFFF"})})}),(0,o.jsx)(e.GestureDetector,{onTap:we,children:(0,o.jsx)(e.Container,{padding:8,children:(0,o.jsx)(e.Icon,{name:"apps",size:24,color:"#FFFFFF"})})}),(0,o.jsx)(e.GestureDetector,{onTap:()=>q(!1),children:(0,o.jsx)(e.Container,{padding:8,children:(0,o.jsx)(e.Icon,{name:"close",size:24,color:"#FFFFFF"})})})]})})]})}),!B&&(0,o.jsx)(e.Positioned,{bottom:40,right:20,children:(0,o.jsx)(e.GestureDetector,{onTap:()=>q(!0),children:(0,o.jsx)(e.Container,{width:50,height:50,decoration:{color:"#1976D2",borderRadius:25,boxShadow:{color:"#00000040",blurRadius:8,offset:{dx:0,dy:4}}},alignment:"center",children:(0,o.jsx)(e.Icon,{name:"settings",size:24,color:"#FFFFFF"})})})})]})})}var E=S(L()),n=S(I());var r=S(Y()),O=({text:s,onTap:t,backgroundColor:a,textColor:i,disabled:c,margin:b})=>(0,r.jsx)(n.GestureDetector,{onTap:c?()=>{}:t,children:(0,r.jsx)(n.Container,{padding:{vertical:12,horizontal:24},decoration:{color:c?"#CCCCCC":a||"#1976D2",borderRadius:8},alignment:"center",margin:b,children:(0,r.jsx)(n.Text,{text:s,color:i||"#FFFFFF",fontSize:16,fontWeight:"bold"})})});function ne(s){let t=(0,n.useNavigator)(),[a,i]=(0,E.useState)(s.role||"controller"),[c,b]=(0,E.useState)(1),[y,N]=(0,E.useState)(""),[z,W]=(0,E.useState)(""),[_,l]=(0,E.useState)(!1),[X,C]=(0,E.useState)(""),[j,m]=(0,E.useState)(null);(0,E.useEffect)(()=>{if(a==="controlee"){let g=f.onClientConnected(async H=>{H.status==="connected"?(m(H.client),await A.startCapture({quality:50,maxWidth:720,maxHeight:1280,frameRate:30})):H.status==="disconnected"&&(m(null),await A.stopCapture())});return()=>{g(),A.stopCapture()}}else A.stopCapture()},[a]);let U=async()=>{await P.stopCall(),await A.stopCapture(),m(null),b(1),N(""),W("")},B=async g=>{if(g)try{await f.copyToClipboard(g)}catch(H){console.error("Copy failed",H)}},q=async()=>{l(!0),C("");try{let g=await P.createOfferToken();N(g),b(2)}catch(g){C("\u751F\u6210\u5931\u8D25: "+g.message)}finally{l(!1)}},V=async()=>{if(y){l(!0),C("");try{let g=await P.createAnswerToken(y);W(g),b(2)}catch(g){C("\u751F\u6210\u5931\u8D25: "+g.message)}finally{l(!1)}}},J=async()=>{if(z){l(!0),C("");try{await P.completeConnection(z),setTimeout(()=>{t.push("/controller/control",{device:{name:"P2P Device",ip:"P2P",port:0}})},1e3)}catch(g){C("\u8FDE\u63A5\u5931\u8D25: "+g.message),l(!1)}}};return(0,r.jsx)(n.Scaffold,{appBar:(0,r.jsx)(n.AppBar,{title:(0,r.jsx)(n.Text,{text:"P2P \u76F4\u8FDE",fontSize:18,color:"#FFFFFF"}),backgroundColor:"#1976D2"}),children:(0,r.jsx)(n.Container,{padding:16,color:"#F5F5F5",children:(0,r.jsx)(n.Column,{children:(0,r.jsx)(n.Container,{padding:16,decoration:{color:"white",borderRadius:8},children:(0,r.jsxs)(n.Column,{children:[(0,r.jsxs)(n.Row,{margin:{bottom:20},children:[(0,r.jsx)(n.Expanded,{children:(0,r.jsx)(O,{text:"\u6211\u662F\u63A7\u5236\u7AEF",backgroundColor:a==="controller"?"#1976D2":"#E0E0E0",textColor:a==="controller"?"#FFFFFF":"#333333",onTap:()=>{i("controller"),b(1),N(""),W(""),C("")},margin:{right:8}})}),(0,r.jsx)(n.Expanded,{children:(0,r.jsx)(O,{text:"\u6211\u662F\u88AB\u63A7\u7AEF",backgroundColor:a==="controlee"?"#1976D2":"#E0E0E0",textColor:a==="controlee"?"#FFFFFF":"#333333",onTap:()=>{i("controlee"),b(1),N(""),W(""),C("")},margin:{left:8}})})]}),X?(0,r.jsx)(n.Text,{text:X,color:"red",margin:{bottom:10}}):null,(0,r.jsx)(n.Column,{children:a==="controller"?(0,r.jsxs)(n.Column,{children:[c===1&&(0,r.jsxs)(n.Column,{children:[(0,r.jsx)(n.Text,{text:"1. \u70B9\u51FB\u751F\u6210\u8FDE\u63A5\u7801\uFF0C\u5E76\u53D1\u9001\u7ED9\u88AB\u63A7\u7AEF\u3002",color:"#666",margin:{bottom:10}}),(0,r.jsx)(O,{text:_?"\u751F\u6210\u4E2D...":"\u751F\u6210\u8FDE\u63A5\u7801",backgroundColor:"#4CAF50",textColor:"#FFFFFF",onTap:q,disabled:_})]}),c>=2&&(0,r.jsxs)(n.Column,{children:[(0,r.jsx)(n.Text,{text:"1. \u8FDE\u63A5\u7801 (\u5DF2\u538B\u7F29\uFF0C\u70B9\u51FB\u590D\u5236):",fontSize:14,margin:{bottom:5}}),(0,r.jsx)(n.GestureDetector,{onTap:()=>B(y),children:(0,r.jsx)(n.Container,{padding:8,decoration:{border:{width:1,color:"#ccc"},borderRadius:4},height:100,children:(0,r.jsx)(n.Text,{text:y,fontSize:12})})}),(0,r.jsx)(n.Text,{text:"2. \u8F93\u5165\u88AB\u63A7\u7AEF\u7684\u54CD\u5E94\u7801:",fontSize:14,margin:{top:20,bottom:5}}),(0,r.jsx)(n.TextField,{text:z,onChanged:W,hintText:"\u5728\u6B64\u7C98\u8D34\u54CD\u5E94\u7801"}),(0,r.jsx)(O,{text:_?"\u8FDE\u63A5\u4E2D...":"\u5F00\u59CB\u63A7\u5236",backgroundColor:"#1976D2",textColor:"#FFFFFF",margin:{top:20},onTap:J,disabled:_||!z})]})]}):(0,r.jsx)(n.Column,{children:j?(0,r.jsxs)(n.Column,{children:[(0,r.jsx)(n.Container,{padding:24,decoration:{color:"#E8F5E9",borderRadius:12,border:{width:1,color:"#C8E6C9"}},margin:{bottom:20},children:(0,r.jsxs)(n.Column,{crossAxisAlignment:"center",children:[(0,r.jsx)(n.Icon,{name:"phonelink_setup",size:48,color:"#4CAF50"}),(0,r.jsx)(n.Text,{text:"\u5DF2\u8FDE\u63A5\u63A7\u5236\u7AEF",fontSize:20,fontWeight:"bold",color:"#2E7D32",margin:{top:16}}),(0,r.jsx)(n.Text,{text:"\u5C4F\u5E55\u6B63\u5728\u5171\u4EAB\u4E2D",fontSize:14,color:"#666",margin:{top:8}})]})}),(0,r.jsx)(O,{text:"\u65AD\u5F00\u8FDE\u63A5",backgroundColor:"#D32F2F",textColor:"#FFFFFF",onTap:U})]}):(0,r.jsxs)(n.Column,{children:[c===1&&(0,r.jsxs)(n.Column,{children:[(0,r.jsx)(n.Text,{text:"1. \u8F93\u5165\u63A7\u5236\u7AEF\u7684\u8FDE\u63A5\u7801:",fontSize:14,margin:{bottom:5}}),(0,r.jsx)(n.TextField,{text:y,onChanged:N,hintText:"\u5728\u6B64\u7C98\u8D34\u8FDE\u63A5\u7801"}),(0,r.jsx)(O,{text:_?"\u751F\u6210\u4E2D...":"\u751F\u6210\u54CD\u5E94\u7801",backgroundColor:"#4CAF50",textColor:"#FFFFFF",margin:{top:20},onTap:V,disabled:_||!y})]}),c===2&&(0,r.jsxs)(n.Column,{children:[(0,r.jsx)(n.Text,{text:"2. \u54CD\u5E94\u7801 (\u5DF2\u538B\u7F29\uFF0C\u70B9\u51FB\u590D\u5236):",fontSize:14,margin:{bottom:5}}),(0,r.jsx)(n.GestureDetector,{onTap:()=>B(z),children:(0,r.jsx)(n.Container,{padding:8,decoration:{border:{width:1,color:"#ccc"},borderRadius:4},height:100,children:(0,r.jsx)(n.Text,{text:z,fontSize:12})})}),(0,r.jsx)(n.Text,{text:"\u7B49\u5F85\u63A7\u5236\u7AEF\u8FDE\u63A5...",color:"green",textAlign:"center",margin:{top:20}})]})]})})})]})})})})})}var We=s=>k.default.createElement(_e,{error:s}),_e=({error:s})=>{let t=(0,u.useNavigator)();return k.default.createElement(u.Container,{color:"#FFEBEE"},k.default.createElement(u.Column,{mainAxisAlignment:"center",crossAxisAlignment:"center",padding:30},k.default.createElement(u.Text,{text:"\u51FA\u9519\u4E86",fontSize:22,color:"#C62828",fontWeight:"bold",margin:{bottom:16}}),k.default.createElement(u.Container,{padding:12,decoration:{color:"#FFFFFF",borderRadius:8,border:{width:1,color:"#FFCDD2"}},margin:{bottom:20}},k.default.createElement(u.Text,{text:s?.message||"\u672A\u77E5\u9519\u8BEF",fontSize:14,color:"#D32F2F",maxLines:5,overflow:"ellipsis"})),k.default.createElement(u.Button,{text:"\u8FD4\u56DE\u9996\u9875",onTap:()=>t.push("/")})))};function re(){try{u.Runtime.bindGlobals(),(0,u.setGlobalErrorFallback)(We),u.Router.register("/",s=>k.default.createElement(ne,s)),u.Router.register("/controller/control",s=>k.default.createElement(oe,s))}catch(s){console.error("[RemoteControl] Init error:",s)}}globalThis.initApp=re;re();})();
/*! Bundled license information:

react/cjs/react-jsx-runtime.production.min.js:
  (**
   * @license React
   * react-jsx-runtime.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)
*/
